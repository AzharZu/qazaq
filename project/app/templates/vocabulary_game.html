{% extends "base.html" %}
{% block content %}
<section class="vocab-shell">
    <div class="d-flex justify-content-start mb-3">
        <a href="/vocabulary" class="btn-ghost text-decoration-none">← Словарь</a>
    </div>
    <h2 class="fw-bold text-center mb-4">Мини-игры словаря — 
        {% if mode == "repeat" %}Повтори слово{% elif mode == "mc" %}Выбери перевод{% else %}Напиши перевод{% endif %}
    </h2>

{% if not word %}
    <div class="text-center text-muted">
        Нет слов для тренировки. <a href="/dictionary">Перейти в словарь</a> и добавьте слова из уроков.
    </div>
{% else %}
    <div class="vocab-game-card shadow-soft">
        <div class="vocab-word text-center mb-3">{{ word.word }}</div>
        {% if mode != "mc" %}
        <div class="text-center mb-3">
            <button class="btn btn-primary btn-sm" id="game-play">▶ Озвучить</button>
        </div>
        {% endif %}

        {% if mode == "repeat" %}
        <form class="vocab-form" id="repeat-form">
            <input type="hidden" name="word_id" value="{{ word.id }}">
            <input type="text" name="answer" class="form-control form-control-lg text-center" placeholder="Введите слово" autocomplete="off">
            <button class="btn btn-primary w-100 mt-3" type="submit">Проверить</button>
            <div class="vocab-feedback mt-3" id="game-feedback"></div>
        </form>
        {% elif mode == "mc" %}
        <input type="hidden" name="word_id" value="{{ word.id }}">
        <div class="d-grid gap-2" id="mc-options">
            {% for opt in options %}
            <button class="btn btn-outline-dark" data-option="{{ opt }}">{{ opt }}</button>
            {% endfor %}
        </div>
        <div class="vocab-feedback mt-3" id="game-feedback"></div>
        {% else %}
        <form class="vocab-form" id="write-form">
            <input type="hidden" name="word_id" value="{{ word.id }}">
            <input type="text" name="answer" class="form-control form-control-lg text-center" placeholder="Введите перевод" autocomplete="off">
            {% if word.example_sentence %}
            <div class="small text-muted mt-2">Подсказка: {{ word.example_sentence }}</div>
            {% endif %}
            <button class="btn btn-primary w-100 mt-3" type="submit">Проверить</button>
            <div class="vocab-feedback mt-3" id="game-feedback"></div>
        </form>
        {% endif %}
        <div class="d-flex justify-content-between align-items-center mt-3">
            <button class="btn btn-outline-dark btn-sm" id="game-next">Следующее слово</button>
            <a class="btn btn-text" href="/dictionary">К словарю</a>
        </div>
    </div>
    {% endif %}
</section>
{% endblock %}

{% block scripts %}
<script>
    window.gameConfig = {
        mode: "{{ mode }}",
        word: {{ {
            "id": word.id if word else None,
            "word": word.word if word else "",
            "translation": word.translation if word else "",
            "definition": word.definition if word else "",
            "example": word.example_sentence if word else "",
            "audio_url": word.audio_url if word else "",
        }|tojson }},
        options: {{ options|tojson if options else "[]" }}
    };
</script>
<script src="{{ url_for('static', path='js/dictionary_games.js') }}?v=2" defer></script>
{% endblock %}
