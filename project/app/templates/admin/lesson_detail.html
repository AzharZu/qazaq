{% extends "base.html" %}
{% block content %}
<div class="card shadow-sm border-0 mb-4">
    <div class="card-body p-4">
        <div class="d-flex flex-wrap justify-content-between align-items-start gap-3">
            <div class="pe-3">
                <div class="text-muted small mb-1">
                    {{ lesson.module.course.name if lesson.module and lesson.module.course else "–ö—É—Ä—Å" }}
                    ¬∑ –ú–æ–¥—É–ª—å "{{ lesson.module.name if lesson.module else '' }}" ¬∑ –£—Ä–æ–∫ ‚Ññ{{ lesson.order }}
                </div>
                <h1 class="h3 fw-bold mb-2">{{ lesson.title }}</h1>
                <p class="text-muted mb-3">{{ lesson.description or "–û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–∫–∞ –ø—É—Å—Ç–æ–µ ‚Äî –¥–æ–±–∞–≤—å—Ç–µ –≤–≤–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è —É—á–∏—Ç–µ–ª—è." }}</p>
                <div class="d-flex flex-wrap gap-2">
                    <span class="badge text-bg-dark">–ë–ª–æ–∫–æ–≤: {{ lesson.blocks|length }}</span>
                    {% if lesson.estimated_time %}<span class="badge text-bg-primary">~{{ lesson.estimated_time }} –º–∏–Ω</span>{% endif %}
                    {% if lesson.difficulty %}<span class="badge text-bg-secondary">–°–ª–æ–∂–Ω–æ—Å—Ç—å: {{ lesson.difficulty }}</span>{% endif %}
                    {% if lesson.age_group %}<span class="badge text-bg-success">–ì—Ä—É–ø–ø–∞: {{ lesson.age_group }}</span>{% endif %}
                    {% if lesson.lesson_type %}<span class="badge text-bg-info">–¢–∏–ø: {{ lesson.lesson_type }}</span>{% endif %}
                </div>
            </div>
            <div class="d-flex flex-column align-items-end gap-2">
                <a class="btn btn-dark" href="/admin/lesson/{{ lesson.id }}/blocks/add">‚ûï –î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫</a>
                <a class="btn btn-outline-primary w-100" href="/admin/lesson/{{ lesson.id }}/edit">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —É—Ä–æ–∫</a>
                <a class="btn btn-outline-dark w-100" href="/lesson/{{ lesson.id }}">üëÅ –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —É—Ä–æ–∫</a>
                <a class="btn btn-outline-secondary w-100" href="/admin/module/{{ lesson.module_id }}/lessons">‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –º–æ–¥—É–ª—é</a>
            </div>
        </div>
    </div>
</div>

<div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
    <div>
        <h5 class="mb-1">–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –±–ª–æ–∫–∞ —É—Ä–æ–∫–∞</h5>
        <p class="text-muted mb-0">–í–∏–¥–Ω–æ –≤—Å—ë —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏ –ø–æ—Ä—è–¥–æ–∫ –±–ª–æ–∫–æ–≤. –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ —Å—Ç—Ä–µ–ª–∫–∞–º–∏ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –ø—Ä—è–º–æ –æ—Ç—Å—é–¥–∞.</p>
    </div>
    <a class="btn btn-dark" href="/admin/lesson/{{ lesson.id }}/blocks/add">‚ûï –î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫</a>
</div>

{% set block_meta = {
    "theory": {"label": "THEORY", "color": "primary", "icon": "üü¶"},
    "example": {"label": "EXAMPLES", "color": "success", "icon": "üü©"},
    "flashcards": {"label": "FLASHCARDS", "color": "warning", "icon": "üüß"},
    "quiz": {"label": "QUIZ", "color": "info", "icon": "üü™"},
    "pronunciation": {"label": "PRONUNCIATION", "color": "secondary", "icon": "üîµ"},
    "dragdrop": {"label": "DRAG & DROP", "color": "secondary", "icon": "üß©"},
    "story": {"label": "STORY", "color": "dark", "icon": "üìñ"},
    "mascot_tip": {"label": "TIP", "color": "light", "icon": "ü¶ä"},
    "default": {"label": "BLOCK", "color": "dark", "icon": "üì¶"}
} %}

<div class="d-flex flex-column gap-3">
    {% for block in lesson.blocks %}
        {% include "admin/components/block_card.html" %}
    {% else %}
        <div class="card shadow-sm border-0">
            <div class="card-body p-4">
                <h5 class="mb-2">–£—Ä–æ–∫ –ø–æ–∫–∞ –ø—É—Å—Ç</h5>
                <p class="text-muted mb-3">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π –±–ª–æ–∫: —Ç–µ–æ—Ä–∏—è, –ø—Ä–∏–º–µ—Ä—ã, –∫–∞—Ä—Ç–æ—á–∫–∏ –∏–ª–∏ –∫–≤–∏–∑—ã ‚Äî –≤—Å—ë –±—É–¥–µ—Ç –≤–∏–¥–Ω–æ –Ω–∞ –æ–¥–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ.</p>
                <a class="btn btn-dark" href="/admin/lesson/{{ lesson.id }}/blocks/add">‚ûï –î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫</a>
            </div>
        </div>
    {% endfor %}
</div>
{% endblock %}
